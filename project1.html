<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 0 - Phoenix Pham</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <img src="images/profile.jpeg" alt="Phoenix Pham" class="profile-pic">
            <h1>Phoenix Pham</h1>
            <p>CS 180 Fall 2025</p>
            <nav>
                <ul>
                    <li><a href="project0.html">Project 0</a></li>
                    <li><a href="project1.html">Project 1</a></li>
                </ul>
            </nav>
        </aside>
        <main class="content">
            <h2>Project 1: Images of the Russian Empireâ€” Colorizing the Prokudin-Gorskii Photo Collection</h3>
            <a href="https://cal-cs180.github.io/fa25/hw/proj1/index.html" target="_blank" rel="noopener noreferrer">[View Assignment]</a>
            <section>
                <h3>Overview</h3>
                <p>
                    The goal of this project is to take digitized Prokudin-Gorskii glass plate images and, using image processing techniques, automatically produce a color image with as few visual artifacts as possible. Each glass plate contains three grayscale exposures (Blue, Green, Red). The task is to extract these channels, align them correctly, and combine them into a single RGB image.
                </p>
            </section>
            <section>
                <h3>Approach</h3>
                <p>
                    Using the provided skeleton Python code, I first imported the images, converted them to floats, and seperated each color channel (by thirds) before alignment. Then, I implemented two main alignment strategies: a naive exhaustive search for smaller images and a pyramid-based coarse-to-fine search for larger images, with additional preprocessing steps to improve alignment on difficult images (e.g., <code>emir.tif</code>'s different color channels). 
                </p>
                <section>
                    <h4>Naive Alignment</h4>
                    <p>
                        The naive approach exhaustively searches over a fixed displacement window (<code>[-15, 15]</code> pixels) and evaluates each shift using a similarity metric. I experimented with:
                    </p>
                    <ul>
                        <li><b>L2 norm:</b> Measures squared pixel differences. Works on simple cases but is sensitive to brightness differences. I used this metric initially for the smaller images.</li>
                        <li><b>Normalized Cross-Correlation (NCC):</b> Normalizes intensity. This produced better results on most images.</li>
                    </ul>
                    <p>
                        To improve accuracy, I cropped 20% of the image borders before scoring to avoid artifacts from dark borders and wrap-around introduced by shifting. This approach immediately worked for the smaller images (e.g., <code>cathedral.jpg</code>, <code>monastery.jpg</code>, <code>tobolsk.jpg</code>).
                    </p>
                </section>
                <section>
                    <h4>Pyramid Alignment</h4>
                    <p>For larger <code>.tif</code> images, the naive approach became too slow. I implemented an image pyramid:</p>
                    <ol>
                        <li>Recursively downsample the image by a factor of 2 until it is small enough.</li>
                        <li>Align at the smallest resolution using the naive method.</li>
                        <li>Scale the displacement estimate back up and refine locally (using a smaller <code>refine_window</code>) at each higher level.</li>
                    </ol>
                </section>
                <section>
                    <h4>Preprocessing (Edge Maps)</h4>
                    <p>
                        While pyramid + NCC worked well for almost all images, <code>emir.tif</code> was problematic due to its brightly colored blue robe. The robe is very bright in the blue channel but appears much darker in red, misleading intensity-based metrics.
                    </p>
                    <p>
                        To address this, I implemented a simple edge detector using gradient magnitude (finite differences in <code>x</code> and <code>y</code>). Aligning on edges rather than raw intensities improved alignment, since structural features (e.g., robe outline) are consistent across channels even if brightness is not. Note this preprocessing step worked for all images except <code>icon.tif</code>. This could be due to the many tiny edges/details in the image. 
                    </p>
                </section>
            </section>
            <section>
                <h3>Problems</h3>
                <p>Without cropping, the algorithm often misaligned due to black/white borders and wrap-around effects. I incorporated a 20% border crop to avoid these artifacts and only use the center of the image for alignment.</p>
                <p>For <code>emir.tif</code>, I needed edge-based preprocessing to handle the strong color differences. To combat this, I implemented a preprocessing step of finding gradient magnitude to produce a "edge detector" map of the image.</p>
                <p>Initially, alignment took several minutes for <code>.tif</code> images. Moving the cropping outside inner loops and using <code>refine_window</code> at higher resolutions reduced runtime to under a minute.</p>
            </section>
            <section>
                <header>
                    <h3>cathedral.jpg</h3>
                </header>
                <p> G aligned to B: (-5, -2)</p>
                <p> R aligned to B: (-12, -3)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/cathedral.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_cathedral.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>monastery.jpg</h3>
                </header>
                <p> G aligned to B: (3, -2)</p>
                <p> R aligned to B: (-3, -2)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/monastery.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_monastery.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>tobolsk.jpg</h3>
                </header>
                <p> G aligned to B: (-3, -3)</p>
                <p> R aligned to B: (-7, -3)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/tobolsk.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_tobolsk.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>church.tif</h3>
                </header>
                <p> G aligned to B: (-25, -4)</p>
                <p> R aligned to B: (-58, 4)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/church.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_church.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>harvesters.tif</h3>
                </header>
                <p> G aligned to B: (-60, -18)</p>
                <p> R aligned to B: (-124, -13)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/harvesters.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_harvesters.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>icon.tif</h3>
                </header>
                <p> G aligned to B: (-41, -17)</p>
                <p> R aligned to B: (-90, -23)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/icon.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_icon.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>italil.tif</h3>
                </header>
                <p> G aligned to B: (-38, -22)</p>
                <p> R aligned to B: (-77, -36)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/italil.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_italil.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>lastochikino.tif</h3>
                </header>
                <p> G aligned to B: (3, 1)</p>
                <p> R aligned to B: (-75, 8)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/lastochikino.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_lastochikino.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>lugano.tif</h3>
                </header>
                <p> G aligned to B: (-41, 17)</p>
                <p> R aligned to B: (-92, 29)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/lugano.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_lugano.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>melons.tif</h3>
                </header>
                <p> G aligned to B: (-80, -10)</p>
                <p> R aligned to B: (-177, -13)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/melons.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_melons.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>self_portrait.tif</h3>
                </header>
                <p> G aligned to B: (-78, -29)</p>
                <p> R aligned to B: (-175, -37)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/self_portrait.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_self_portrait.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>siren.tif</h3>
                </header>
                <p> G aligned to B: (-49, 6)</p>
                <p> R aligned to B: (-96, 24)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/siren.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_siren.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>three_generations.tif</h3>
                </header>
                <p> G aligned to B: (-53, -13)</p>
                <p> R aligned to B: (-111, -9)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/three_generations.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_three_generations.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>emir.tif</h3>
                </header>
                <p> G aligned to B: (-49, -24)</p>
                <p> R aligned to B: (-107, -40)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/emir.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_emir.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>capri.tif</h3>
                </header>
                <p> G aligned to B: (-28, 17)</p>
                <p> R aligned to B: (-65, 34)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/capri.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_capri.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>milan.tif</h3>
                </header>
                <p> G aligned to B: (-57, -13)</p>
                <p> R aligned to B: (-125, -24)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/milan.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_milan.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
            <section>
                <header>
                    <h3>painting.tif</h3>
                </header>
                <p> G aligned to B: (-30, -1)</p>
                <p> R aligned to B: (-70, -6)</p>
                <div class="before-after-container">
                    <div class="before">
                        <img src="images/painting.jpg" alt="Before">
                        <p class="caption">Before</p>
                    </div>
                    <div class="after">
                        <img src="images/out_painting.jpg" alt="After">
                        <p class="caption">After</p>
                    </div>
                </div>
            </section>
        </main>
    </div>
</body>
</html>